# mysql查询性能优化

## 一、 目的：为什么要进行查询优化？

减少和消除一些不必要操作花费的时间

## 二、优化1：减少访问的数据量

从如下两点分析

- #### 1. 是否向数据库请求了不需要的数据
  
  典型案例：
  
  - ##### 查询不需要的记录
    
    解决技巧：使用Limit限制返回记录
  
  - ##### 多表关联返回全部列
    
    解决技巧：返回需要的列
  
  - ##### select * 取出全部列
    
    解决技巧：使用缓存，或者查询需要的列
  
  - ##### 重复查询相同数据
    
    解决技巧：使用缓存

- #### 2. 是否存在扫描了额外的记录
  
  三个重要指标：
  
  - ##### 响应时间
    
     响应时间=服务时间+等待时间
  
  - ##### 扫描的行数和返回的行数
    
    比值越大，效率越差
  
  - ##### 扫描的行数和访问类型
    
    参考执行计划rows和type
  
  解决额外扫描技巧
  
  - ###### 使用索引覆盖扫描
  
  - ###### 改变库结构
  
  - ###### 重写复杂sql

## 3、优化2：重构查询方式

- #### 1. 复杂查询拆成简单查询（需衡量）

- #### 2. 大查询切分成小查询（适用于需要删除大量数据）

- #### 3. 分解关联查询
  
  ###### 分解关联查询优势
  
  - 让缓存效率更高
  - 单个查询可减少锁的竞争
  - 应用层做关联，容易对数据库进行拆分，高性能与可扩展
  - 提升查询效率
  - 减少冗余记录查询
  - 在应用中实现哈希关联，而非嵌套循环关联
  
  ###### 分解关联查询适用场景
  
  - 应用能够方便缓存单个查询结果的时候
  - 可以将数据分布到不同MySQL服务器的时候
  - 能使用IN代替关联查询的时候
  - 查询中使用同一个数据表的时候
