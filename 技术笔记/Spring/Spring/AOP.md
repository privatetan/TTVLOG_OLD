# AOP

## AOP

切面编程：横向扩展Bean，实现解耦合。



## 基本组件

- ##### Aspect：切面，通知+切点

- ##### Jointpoint：连接点，可以被增强的方法。

- ##### Pointcut：切点，实际被增强的方法。

- ##### Advice：通知，增强的功能。

  - 前置通知：在切点之前执行的逻辑部分。
  - 后置通知：在切点之后执行的逻辑部分；后置正常通知。
  - 环绕通知：在切点前后执行的逻辑部分。
  - 异常通知：当切点发生异常执行的逻辑部分；后置异常通知。
  - 最终通知：相当于java代码中的try-catch-finally中fianlly部分；后置最终通知。

  ###### 通知调用顺序：前置通知→环绕通知→后置正常返回通知/后置异常返回通知→后置最终通知

- ##### Target：目标对象，被代理对象。

- ##### Weaving：织入，创建代理类的过程。



## 实现原理

SpringAOP通过动态代理实现。即使用JDK Proxy或CGLIB动态代理实现。



## 动态代理&静态代理

- #### 动态代理：

  编译完成后没有实际的Class文件，在运行时动态生成代理类。JDK Proxy 和CGLIB。

- #### 静态代理

  编译时完成代理类的实现，并生成Class文件。AspectJ支持静态代理。



## JDK Proxy & CGLIB

- #### JDK Proxy

  JDK自带的动态代理实现；

  基于反射实现；

  需被代理类实现接口，代理类与被代理类属于兄弟关系；

- #### CGLIB

  基于字节码实现代理；

  无需被代理类实现接口，代理类与被代理类属于子父关系。

  

## AspectJ

AspectJ是一个java实现的更为强大的AOP框架，也是实际意义的**AOP标准**；



#### AspectJ与Spring AOP的关系？

SpringAOP使用了AspectJ一样的注解，但是运行时候使用的是Spring AOP并非AspectJ的编译器或织入器，两者属于互补增强关系。



#### AspectJ与Spring AOP的区别？

**Spring AOP更易用，AspectJ更强大**

| Spring AOP                                       | AspectJ                                                      |
| ------------------------------------------------ | ------------------------------------------------------------ |
| 在纯 Java 中实现                                 | 使用 Java 编程语言的扩展实现                                 |
| 不需要单独的编译过程                             | 除非设置 LTW，否则需要 AspectJ 编译器 (ajc)                  |
| 只能使用运行时织入                               | 运行时织入不可用。支持编译时、编译后和加载时织入             |
| 功能不强-仅支持方法级编织                        | 更强大 - 可以编织字段、方法、构造函数、静态初始值设定项、最终类/方法等...... |
| 只能在由 Spring 容器管理的 bean 上实现           | 可以在所有域对象上实现                                       |
| 仅支持方法执行切入点                             | 支持所有切入点                                               |
| 代理是由目标对象创建的, 并且切面应用在这些代理上 | 在执行应用程序之前 (在运行时) 前, 各方面直接在代码中进行织入 |
| 比 AspectJ 慢多了                                | 更好的性能                                                   |
| 简单易用                                         | 相对于 Spring AOP 来说更复杂                                 |

